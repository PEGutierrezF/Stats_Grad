---
title: "Analysis of Variance"
subtitle: "(ANOVA)"
author: "Pablo E. Guti\u00E9rrez-Fonseca"
institute: ""
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, "css/nhsr.css", "css/nhsr-fonts.css", "css/custom.css"]
    nature:
      highlightLanguage: r
      highlightStyle: github
      highlightLines: true
      highlightSpans: true 
      countIncrementalSlides: true
      ratio: "16:9"
    includes:
      after_body: [css/insert-logo.html]
xaringanExtra:
    use_panelset: true
---
```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(readr)
library(lessR)
library(ggplot2)
xaringanExtra::use_panelset()
```

# What is ANOVA
- Analysis of Variance (ANOVA) is a statistical technique, commonly used to studying differences between two or more group means. 

- ANOVA test is centered on the different sources of variation in a typical variable.

- This statistical method is an extension of the t-test. 

- It is used in a situation where the factor variable has more than one group.

---
# Hypothesis in one-way ANOVA test
.pull-left[
- $H_0$: All group means are equal.

  - $H_0: \mu_1 = \mu_2 = \mu_3 = \dots = \mu_k$
]

.pull-right[ 
- $H_a$: At least, the mean of one group is different

  - $H_A: \mu_i \neq \mu_j \quad \text{for some } i, j$
]

<center>
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=5}
# Simulate data for three groups
set.seed(123)
data <- data.frame(
  Group = rep(c("Group 1", "Group 2", "Group 3"), each = 30),
  Value = c(rnorm(30, mean = 50, sd = 5),  # Group 1
            rnorm(30, mean = 50, sd = 5),  # Group 2 (same mean as Group 1)
            rnorm(30, mean = 55, sd = 5))  # Group 3 (different mean)
)

# Calculate the means for each group
group_means <- aggregate(Value ~ Group, data, mean)

# Create the density plot with vertical lines at the means
ggplot(data, aes(x = Value, fill = Group)) +
  geom_density(alpha = 0.6) +
  geom_vline(data = group_means, aes(xintercept = Value, color = Group),
             linetype = "dashed", size = 1) +
  theme_minimal() +
  labs(title = "",
       x = "Value", y = "Density") +
  scale_fill_brewer(palette = "Set2") +
  scale_color_brewer(palette = "Set2", guide = "none")
```


---
# When would you run an ANOVA?

- I have a continuous response variable.

- I want to know the difference in that response between more than two groups.

- I have one factor I am testing (One-Way ANOVA).

---
# Assumptions

- All groups are Independent.

- The data is normally distributed.

- All groups have approximately equal variance.
  - A good rule of thumb: ratio of largest to smallest group stdev must be less than 2:1
  - The ANOVA is less sensitive to this requirement when samples are of equal size from each population.

---
# How ANOVA works 
- The ANOVA obtained value (the **F-statistic**) is a ratio of the Between Group Variation divided by the Within Group Variation:      

<center>
F = $\frac{\text{Variation}_{\text{between}}}{\text{Variation}_{\text{within}}}$
</center>

- A large **F** is evidence against $H_0$, since it indicates that there is more difference between groups than within groups.


---

# One-way ANOVA Summary Table

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          $c - 1$                  |             $SSB$                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          $n - c$                  |             $SSW$                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          $n - 1$                  |      $SST = SSB + SSW$            |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Formulas

.pull-left[ 
- The formula for the Sum of Squares Between (SSB) is given by:
$$ SSB = \sum_{j=1}^{C} n_j (\bar{x}_j - \bar{x})^2 $$

Where:
- $C$ = number of groups
- $n_j$ = sample size of group $j$
- $\bar{x}_j$ = mean of group $j$
- $\bar{x}$ = overall mean
]

.pull-right[ ]


---
# One-way ANOVA Formulas

.pull-left[ 
- The formula for the Sum of Squares Between (SSB) is given by:
$$ SSB = \sum_{j=1}^{C} n_j (\bar{x}_j - \bar{x})^2 $$

Where:
- $C$ = number of groups
- $n_j$ = sample size of group $j$
- $\bar{x}_j$ = mean of group $j$
- $\bar{x}$ = overall mean
]

.pull-right[
- The formula for the Sum of Squares Within (SSW) is given by:  

$$SSW = \sum_{j=1}^{C} \sum_{i=1}^{n_j} (\bar{x}_j - \bar{x})^2$$

Where:
- $C$ = number of groups
- $n_j$ = sample size of group $j$
- $\bar{x}_j$ = mean of group $j$
- $\bar{x}$ = overall mean
]



---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested..

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          $c - 1$                  |             2150                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          $n - c$                  |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          $n - 1$                  |      $SST = SSB + SSW$            |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested..

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                  |             2150                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          $n - c$                  |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          $n - 1$                  |      $SST = SSB + SSW$            |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.



---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested..

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                  |             2150                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          34                  |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          $n - 1$                  |      $SST = SSB + SSW$            |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested..

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                  |             2150                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          34                  |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          39                  |      $SST = SSB + SSW$            |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    $MSB = \frac{SSB}{c - 1}$  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          34                       |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.

---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    430  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          34                       |             5269                 |    $MSW = \frac{SSW}{n - c}$  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    430  |       $\frac{MSB}{MSW}$  |
| **Within<br/> Groups**           |          34                       |             5269                 |    155  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    430  |       2.77  |
| **Within<br/> Groups**           |          34                       |             5269                 |    155  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.


---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    430  |       2.77  |
| **Within<br/> Groups**           |          34                       |             5269                 |    155  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.
- `p_value <- 1 - pf(f_statistic, df_B, df_W)` = **0.03326991**

---
# Effect Size Measures
- Significant **F ratios** indicate that there is a difference between the treatment groups that cannot be explained by chance alone.
  
- Effect size measures help determine how big or meaningful the effect of the treatment is.


---
# Effect Size Measures
- One simple effect size measure:
<center>
$r^2 = \frac{\text{SSB}}{\text{SST}}$

Where:
  - **SSB** is the sum of squares between groups (variability due to group differences),
  - **SST** is the total sum of squares (total variability in the dataset).

- This measure shows how much of the total variability in the data can be explained by the different groupings.   
- **What is meaningful?**  
It depends on how much of the total variability you would expect this grouping to account for.

---
# One-way ANOVA Summary Table
- In a study on plant growth with a sample size of **40**, **six different fertilizer** types were tested.

| Source of<br/> Variation          |   Degrees of<br/> Freedom (DF)   |     Sum of Squares<br/> (SS)     |     Mean Square<br/> (MS)   |        F-value        |
|----------------------------------|:----------------------------------:|:----------------------------------:|:---------------------------:|:---------------------:|
| **Between<br/> Groups**          |          5                        |             2150                 |    430  |       2.77  |
| **Within<br/> Groups**           |          34                       |             5269                 |    155  |                       |
| **Total**                        |          39                       |             7419                 |                           |                       |

- $c$ = number of groups.  
- $n$ = number of observations.
- `p_value <- 1 - pf(f_statistic, df_B, df_W)` = **0.03326991**
-  $R^2 = \frac{SSB}{SST}  =  \frac{2150}{7419}$ = **0.2897**


---
# Finding the critical value for an F-test

.pull-left[ 
- You will need the critical F table that matches your significance level.

- And you will need to know the degrees of freedom for both the between and within variability.

]

.pull-right[ 
<img src="fig/t-table_1.png" alt="Degrees of Freedom T-Table" width="600"/>
]

---
# How to summarize results

<span style="color:#00796B;">State the original research question / hypothesis. </span> <span style="color:#E65100;">Briefly describe the methods including the type of test run:  One-way ANOVA, if significant type of Means Comparison (e.g. Tukeyâ€™s HSD Means Comparison). </span> <span style="color:#1E88E5;">Describe your results including: Shorthand ( $F_{(5, 34)} = 2.77, p < 0,003, r^2 = 29 )$, Results of any means comparison (which groups are larger than which other groups? Which are the same?
. </span>  <span style="color:#424242;"> Interpret significance and effect size (r2), big picture: what does this mean in terms of your original research question?.</span> 
