---
title: "t-tests"
subtitle: "Tests between the means of different groups"
author: "Pablo E. Gutierrez-Fonseca"
institute: ""
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, "css/nhsr.css", "css/nhsr-fonts.css", "css/custom.css"]
    nature:
      highlightLanguage: r
      highlightStyle: github
      highlightLines: true
      highlightSpans: true 
      countIncrementalSlides: true
      ratio: "16:9"
    includes:
      after_body: [css/insert-logo.html]
xaringanExtra:
    use_panelset: true
---


# When would you run a t-test?

- You have a continuous response variable.

- You want to test for a **difference between two sample means**: considering the variance within each group, do the groups belong to two distinct populations, or not?

- Data is **normally distributed** and both groups have approximately **equal variance**. 

- If the groups are **not related** in any way = **Independent t-test**

- If the groups are **related (paired)** = Dependent t-test (or matched pairs t-test).


---

# Independent vs. Dependent groups

How do I know if my samples are independent or dependent?  

Can you tell exactly which observation should be paired with which other observation?  If you canâ€™t tell, your groups are independent

.pull-left[
**Examples of Independent Samples**

1. Treated and untreated, randomly located plots.
2. Monitoring sites set up with Systematic (grid) sampling.
3. Infested and uninfested forest stands selected with stratified random sampling.
]

.pull-right[
**Examples of Dependent Samples**

1. Before and After data taken on the same observation.
2. Paired watersheds / plots.
3. Parent / offspring studies.
4. Twin studies / partner studies. 
]

---

# Independent vs. Dependent groups

.pull-left[
**Independent t-test** quantifies the difference between sample means (numerator) vs. the amount of variability in the samples (denominator). 


$$
t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{\frac{(n_1 - 1)s_1^2 + (n_2 - 1)s_2^2}{n_1 + n_2 - 2} \left( \frac{1}{n_1} + \frac{1}{n_2} \right)}}
$$
DF (for the critical value)= (n1 + n2)-2

]


.pull-right[
**Dependent t-test** quantifies the magnitude of the difference between paired observations (numerator) vs. the amount of variability in the samples (denominator).

$$
t = \frac{\sum D}{\sqrt{\frac{n \sum D^2 - (\sum D)^2}{n-1}}}
$$

DF (for the critical value) = n-1    
where n is the number of paired observations


]

---

# Basic Steps for an Inferential t-Test

.pull-left[ 

```{r, eval=F}
t.test(x= , y = ,
       mu = 0, 
       paired = , 
       var.equal= .
       alternative = c("two.sided", "less", "greater"))

```

<br>

```{r, eval=F}
wilcox.testt(x= , y = ,
       mu = 0, 
       paired = , 
       var.equal= .
       alternative = c("two.sided", "less", "greater"))

```

]


.pull-right[ 

<center>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
DiagrammeR::mermaid("

  graph TD
    A[Normally distribute data?]--Yes--> B[t.test]
    A[Normally distribute data?]--No--> C[wilcox.test]
    
  style A fill:lightblue,stroke:#333,stroke-width:1px
  style B fill:lightblue,stroke:#333,stroke-width:1px
  style C fill:lightblue,stroke:#333,stroke-width:1px

")
```

</center>
]


---

# Basic Steps for an Inferential t-Test


.pull-left[ 
```{r, eval=F}
t.test(x= , y = ,
       mu = 0, 
       `paired = `, 
       var.equal= ,
       alternative = c("two.sided", "less", "greater")
       )

```
]


.pull-right[ 
<center>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(DiagrammeR)
mermaid("
graph TD;
    A[Paired?]--Yes--> B[Dependend t-test, use paired=TRUE]
    A[Paired?]--No--> C[Independend t-test, use paired=FALSE]
    
")
```
</center>

]


---

# Basic Steps for an Inferential t-Test


.pull-left[ 
```{r, eval=F}
t.test(x= , y = ,
       mu = 0, 
       paired = , 
       `var.equal= `, 
       alternative = c("two.sided", "less", "greater")
       )
```
]


.pull-right[ 
<center>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(DiagrammeR)
mermaid("
graph TD;
    A[Equal variance?] -->|Yes| B[Set var.equal to TRUE];
    A -->|No| C[Set var.equal to FALSE];
")
```

</center>
]


---

# Basic Steps for an Inferential t-Test


.pull-left[ 
```{r, eval=F}
t.test(x= , y = ,
       mu = 0, 
       paired = , 
       var.equal= , 
       `alternative = c("two.sided", "less", "greater")`
       )
```
]


.pull-right[ 
<center>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(DiagrammeR)
mermaid("
graph TD;
    A[Two-sided?] -->|Yes| B[Use alternative = 'less'];
    A -->|Yes| C[Use alternative = 'greater'];
    A -->|No| D[Use alternative = 'two.sided'];
")
```
</center>
]


---

# Step in R

1. Import libraries and/or install packages.

2. Import your data.

3. Run descriptive statistics.

4. Visualize your distribution.

5. Test for normality.

6. Test for equal variance.

7. Determine if the test is paired or unpaired.

8. Run the code for the appropriate test.

---


# Effect Size (Cohen's)

- Effect size is a measure of how different two groups are from one another.


.pull-left[
**Independent t-test**


$$
ES = \frac{\bar{X}_1 - \bar{X}_2}{SD}
$$

]


.pull-right[
**Dependent t-test** 
$$
ES = \frac{\bar{X}_D}{SD}
$$
Where: $\bar{X}_D$ is the mean of the differences between paired observations, and SD is the standard deviation of the differences.


]



---

# Effect Size (Cohen's)

- Effect size is a measure of how different two groups are from one another.


.pull-left[
**Independent t-test**


$$
ES = \frac{\bar{X}_1 - \bar{X}_2}{SD}
$$

<br>
<br>
<br>

- Cohen's ES (d)  
  - Small = 0.0 - .20  
  - Medium = 0.20 - 0.50  
  - Large = 0.50 and above  



]


.pull-right[
**Dependent t-test** 
$$
ES = \frac{\bar{X}_D}{SD}
$$
Where: $\bar{X}_D$ is the mean of the differences between paired observations, and SD is the standard deviation of the differences.

]

---

# The Basic Steps for an Inferential Test in R

- Start with a research question and your data ready.

- Follow these steps:
1. State your hypothesis. 
2. Work in R
    - Import libraries and load necessary packages.
    - Import your data.
    - Run descriptive statistics to understand your data.
    - Visualize the data distribution.
    - est for normality and check other assumptions (e.g., equal variance).
3. Select the appropriate statistical test. 
4. Run the analysis in R and evaluate statistical significance.
5. Calculate Cohen's Effect Size (if relevant).
5. Summarize your findings.

---
# Two-tailed t-test Example

**Research Question**:  The state is looking to choose a stream for habitat restoration for native trout species.  Streams with deeper pools will provide necessary cover in the winter months and minimize potential scouring from severe rain events.  Which stream should they focus on?  Test to see if there is a significant difference in depth between stream 1 and stream 2?

```{r, warning=FALSE}
stream_data <- read.csv('Lecturer Practice/two_tail_water data.csv')
head(stream_data)
```

---

# Step 1. Normality test

- Test for normality

.pull-left[ 
```{r  warning=FALSE, highlight.output = 7:8}
library(RVAideMemoire)
byf.shapiro(depth_cm~waterbody, data=stream_data)
```
]

.pull-right[ 
- Since both p-values are greater than 0.05, we fail to reject the null hypothesis for both streams. 

- This indicates that the data are **normally distributed** for both Stream 1 and Stream 2. 
]


---

# Step 2. Equal variance

.pull-left[
```{r, highlight.output = 5}
#var.test
var.test(depth_cm ~ waterbody, data=stream_data)
```
]

.pull-right[

- Since the p-value is greater than 0.05, we fail to reject the null hypothesis. 

- Therefore, we conclude that the **variances** of pool depth between the two streams are **equal**.
]

---

# Conducting the t-test

Based on the results of the Shapiro-Wilk normality test, which indicated that both Stream 1 and Stream 2 data are normally distributed, and the F-test for equal variance, which showed that the variances are equal, we proceeded to conduct a two-tailed independent t-test.

---

# Conducting the t-test

```{r tx-wrangle, highlight.output = 5}
t.test(depth_cm ~ waterbody, data=stream_data,
       alternative = c("two.sided"),
       mu = 0, 
       paired = FALSE, 
       var.equal = TRUE,
       conf.level = 0.95)
```

---

# Summary

<span style="color:#00796B;">We tested to see if there was a significant difference in pool depth between Stream 1 and Stream 2, which are being considered for habitat restoration for native trout species.</span> <span style="color:#E65100;">Using a two-tailed independent t-test to compare depth measurements from 71 total samples,</span> <span style="color:#1E88E5;">we found a significant and meaningful difference between the streams ( $t_{(69)} = -12.92, \, p < 2.2 \times 10^{-16})$.</span>  <span style="color:#424242;">This indicates that Stream 2, with deeper pools, may provide more suitable habitat for trout, offering better cover during winter and reducing the risk of scouring during severe rain events.</span> 

---
